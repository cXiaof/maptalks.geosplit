/*!
 * maptalks.geosplit v0.1.0-alpha.1
 * LICENSE : MIT
 * (c) 2016-2018 maptalks.org
 */
!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports):"function"==typeof define&&define.amd?define(["exports"],e):e(t.maptalks=t.maptalks||{})}(this,function(t){"use strict";var e="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{};function n(t,e){return t(e={exports:{}},e.exports),e.exports}var r={Point2D:n(function(t){function e(t,e){Object.defineProperties(this,{x:{value:void 0!==t?t:0,writable:!1,enumerable:!0,configurable:!1},y:{value:void 0!==e?e:0,writable:!1,enumerable:!0,configurable:!1}})}e.prototype.clone=function(){return new this.constructor(this.x,this.y)},e.prototype.add=function(t){return new this.constructor(this.x+t.x,this.y+t.y)},e.prototype.subtract=function(t){return new this.constructor(this.x-t.x,this.y-t.y)},e.prototype.multiply=function(t){return new this.constructor(this.x*t,this.y*t)},e.prototype.divide=function(t){return new this.constructor(this.x/t,this.y/t)},e.prototype.equals=function(t){return this.x===t.x&&this.y===t.y},e.prototype.precisionEquals=function(t,e){return Math.abs(this.x-t.x)<e&&Math.abs(this.y-t.y)<e},e.prototype.lerp=function(t,e){var n=1-e;return new this.constructor(this.x*n+t.x*e,this.y*n+t.y*e)},e.prototype.distanceFrom=function(t){var e=this.x-t.x,n=this.y-t.y;return Math.sqrt(e*e+n*n)},e.prototype.min=function(t){return new this.constructor(Math.min(this.x,t.x),Math.min(this.y,t.y))},e.prototype.max=function(t){return new this.constructor(Math.max(this.x,t.x),Math.max(this.y,t.y))},e.prototype.transform=function(t){return new this.constructor(t.a*this.x+t.c*this.y+t.e,t.b*this.x+t.d*this.y+t.f)},e.prototype.toString=function(){return"point("+this.x+","+this.y+")"},t.exports=e}),Vector2D:n(function(t){function n(t,e){Object.defineProperties(this,{x:{value:void 0!==t?t:0,writable:!1,enumerable:!0,configurable:!1},y:{value:void 0!==e?e:0,writable:!1,enumerable:!0,configurable:!1}})}n.fromPoints=function(t,e){return new n(e.x-t.x,e.y-t.y)},n.prototype.length=function(){return Math.sqrt(this.x*this.x+this.y*this.y)},n.prototype.magnitude=function(){return this.x*this.x+this.y*this.y},n.prototype.dot=function(t){return this.x*t.x+this.y*t.y},n.prototype.cross=function(t){return this.x*t.y-this.y*t.x},n.prototype.determinant=function(t){return this.x*t.y-this.y*t.x},n.prototype.unit=function(){return this.divide(this.length())},n.prototype.add=function(t){return new this.constructor(this.x+t.x,this.y+t.y)},n.prototype.subtract=function(t){return new this.constructor(this.x-t.x,this.y-t.y)},n.prototype.multiply=function(t){return new this.constructor(this.x*t,this.y*t)},n.prototype.divide=function(t){return new this.constructor(this.x/t,this.y/t)},n.prototype.angleBetween=function(t){var e=this.dot(t)/(this.length()*t.length());e=Math.max(-1,Math.min(e,1));var n=Math.acos(e);return this.cross(t)<0?-n:n},n.prototype.perp=function(){return new this.constructor(-this.y,this.x)},n.prototype.perpendicular=function(t){return this.subtract(this.project(t))},n.prototype.project=function(t){var e=this.dot(t)/t.dot(t);return t.multiply(e)},n.prototype.transform=function(t){return new this.constructor(t.a*this.x+t.c*this.y,t.b*this.x+t.d*this.y)},n.prototype.equals=function(t){return this.x===t.x&&this.y===t.y},n.prototype.precisionEquals=function(t,e){return Math.abs(this.x-t.x)<e&&Math.abs(this.y-t.y)<e},n.prototype.toString=function(){return"vector("+this.x+","+this.y+")"},t.exports=n}),Matrix2D:n(function(t){function s(t,e,n){Object.defineProperty(t,e,{value:n,writable:!1,enumerable:!0,configurable:!1})}function o(t,e,n,r,o,i){s(this,"a",void 0!==t?t:1),s(this,"b",void 0!==e?e:0),s(this,"c",void 0!==n?n:0),s(this,"d",void 0!==r?r:1),s(this,"e",void 0!==o?o:0),s(this,"f",void 0!==i?i:0)}s(o,"IDENTITY",new o(1,0,0,1,0,0)),s(o.IDENTITY,"isIdentity",function(){return!0}),o.translation=function(t,e){return new o(1,0,0,1,t,e)},o.scaling=function(t){return new o(t,0,0,t,0,0)},o.scalingAt=function(t,e){return new o(t,0,0,t,e.x-e.x*t,e.y-e.y*t)},o.nonUniformScaling=function(t,e){return new o(t,0,0,e,0,0)},o.nonUniformScalingAt=function(t,e,n){return new o(t,0,0,e,n.x-n.x*t,n.y-n.y*e)},o.rotation=function(t){var e=Math.cos(t),n=Math.sin(t);return new o(e,n,-n,e,0,0)},o.rotationAt=function(t,e){var n=Math.cos(t),r=Math.sin(t);return new o(n,r,-r,n,e.x-e.x*n+e.y*r,e.y-e.y*n-e.x*r)},o.rotationFromVector=function(t){var e=t.unit(),n=e.x,r=e.y;return new o(n,r,-r,n,0,0)},o.xFlip=function(){return new o(-1,0,0,1,0,0)},o.yFlip=function(){return new o(1,0,0,-1,0,0)},o.xSkew=function(t){return new o(1,0,Math.tan(t),1,0,0)},o.ySkew=function(t){return new o(1,Math.tan(t),0,1,0,0)},o.prototype.multiply=function(t){return this.isIdentity()?t:t.isIdentity()?this:new this.constructor(this.a*t.a+this.c*t.b,this.b*t.a+this.d*t.b,this.a*t.c+this.c*t.d,this.b*t.c+this.d*t.d,this.a*t.e+this.c*t.f+this.e,this.b*t.e+this.d*t.f+this.f)},o.prototype.inverse=function(){if(this.isIdentity())return this;var t=this.a*this.d-this.b*this.c;if(0===t)throw"Matrix is not invertible";var e=1/t,n=this.f*this.c-this.e*this.d,r=this.e*this.b-this.f*this.a;return new this.constructor(this.d*e,-this.b*e,-this.c*e,this.a*e,n*e,r*e)},o.prototype.translate=function(t,e){return new this.constructor(this.a,this.b,this.c,this.d,this.a*t+this.c*e+this.e,this.b*t+this.d*e+this.f)},o.prototype.scale=function(t){return new this.constructor(this.a*t,this.b*t,this.c*t,this.d*t,this.e,this.f)},o.prototype.scaleAt=function(t,e){var n=e.x-t*e.x,r=e.y-t*e.y;return new this.constructor(this.a*t,this.b*t,this.c*t,this.d*t,this.a*n+this.c*r+this.e,this.b*n+this.d*r+this.f)},o.prototype.scaleNonUniform=function(t,e){return new this.constructor(this.a*t,this.b*t,this.c*e,this.d*e,this.e,this.f)},o.prototype.scaleNonUniformAt=function(t,e,n){var r=n.x-t*n.x,o=n.y-e*n.y;return new this.constructor(this.a*t,this.b*t,this.c*e,this.d*e,this.a*r+this.c*o+this.e,this.b*r+this.d*o+this.f)},o.prototype.rotate=function(t){var e=Math.cos(t),n=Math.sin(t);return new this.constructor(this.a*e+this.c*n,this.b*e+this.d*n,this.a*-n+this.c*e,this.b*-n+this.d*e,this.e,this.f)},o.prototype.rotateAt=function(t,e){var n=Math.cos(t),r=Math.sin(t),o=e.x,i=e.y,s=this.a*n+this.c*r,a=this.b*n+this.d*r,u=this.c*n-this.a*r,c=this.d*n-this.b*r;return new this.constructor(s,a,u,c,(this.a-s)*o+(this.c-u)*i+this.e,(this.b-a)*o+(this.d-c)*i+this.f)},o.prototype.rotateFromVector=function(t){var e=t.unit(),n=e.x,r=e.y;return new this.constructor(this.a*n+this.c*r,this.b*n+this.d*r,this.a*-r+this.c*n,this.b*-r+this.d*n,this.e,this.f)},o.prototype.flipX=function(){return new this.constructor(-this.a,-this.b,this.c,this.d,this.e,this.f)},o.prototype.flipY=function(){return new this.constructor(this.a,this.b,-this.c,-this.d,this.e,this.f)},o.prototype.skewX=function(t){var e=Math.tan(t);return new this.constructor(this.a,this.b,this.c+this.a*e,this.d+this.b*e,this.e,this.f)},o.prototype.skewY=function(t){var e=Math.tan(t);return new this.constructor(this.a+this.c*e,this.b+this.d*e,this.c,this.d,this.e,this.f)},o.prototype.isIdentity=function(){return 1===this.a&&0===this.b&&0===this.c&&1===this.d&&0===this.e&&0===this.f},o.prototype.isInvertible=function(){return this.a*this.d-this.b*this.c!=0},o.prototype.getScale=function(){return{scaleX:Math.sqrt(this.a*this.a+this.c*this.c),scaleY:Math.sqrt(this.b*this.b+this.d*this.d)}},o.prototype.getDecomposition=function(){var t=.5*(this.a+this.d),e=.5*(this.a-this.d),n=.5*(this.b+this.c),r=.5*(this.b-this.c),o=Math.sqrt(t*t+r*r),i=Math.sqrt(e*e+n*n),s=o+i,a=o-i,u=Math.atan2(n,e),c=Math.atan2(r,t),h=.5*(c-u),l=.5*(c+u);return{translation:new this.constructor(1,0,0,1,this.e,this.f),rotation:this.constructor.IDENTITY.rotate(l),scale:new this.constructor(s,0,0,a,0,0),rotation0:this.constructor.IDENTITY.rotate(h)}},o.prototype.equals=function(t){return this.a===t.a&&this.b===t.b&&this.c===t.c&&this.d===t.d&&this.e===t.e&&this.f===t.f},o.prototype.precisionEquals=function(t,e){return Math.abs(this.a-t.a)<e&&Math.abs(this.b-t.b)<e&&Math.abs(this.c-t.c)<e&&Math.abs(this.d-t.d)<e&&Math.abs(this.e-t.e)<e&&Math.abs(this.f-t.f)<e},o.prototype.toString=function(){return"matrix("+[this.a,this.b,this.c,this.d,this.e,this.f].join(",")+")"},t.exports=o})},o=n(function(t){function d(){this.init(arguments)}d.TOLERANCE=1e-6,d.ACCURACY=15,d.interpolate=function(t,e,n,r,o){if(t.constructor!==Array||e.constructor!==Array)throw new Error("Polynomial.interpolate: xs and ys must be arrays");if(isNaN(n)||isNaN(r)||isNaN(o))throw new Error("Polynomial.interpolate: n, offset, and x must be numbers");for(var i=0,s=0,a=new Array(n),u=new Array(n),c=0,h=Math.abs(o-t[r]),l=0;l<n;l++){var y=Math.abs(o-t[r+l]);y<h&&(c=l,h=y),a[l]=u[l]=e[r+l]}i=e[r+c],c--;for(var p=1;p<n;p++){for(l=0;l<n-p;l++){var f=t[r+l]-o,d=t[r+l+p]-o,v=a[l+1]-u[l],g=f-d;if(0==g)throw new Error("Unable to interpolate polynomial. Two numbers in n were identical (to within roundoff)");g=v/g,u[l]=d*g,a[l]=f*g}i+=s=2*(c+1)<n-p?a[c+1]:u[c--]}return{y:i,dy:s}},d.prototype.init=function(t){this.coefs=new Array;for(var e=t.length-1;0<=e;e--)this.coefs.push(t[e]);this._variable="t",this._s=0},d.prototype.eval=function(t){if(isNaN(t))throw new Error("Polynomial.eval: parameter must be a number");for(var e=0,n=this.coefs.length-1;0<=n;n--)e=e*t+this.coefs[n];return e},d.prototype.add=function(t){for(var e=new d,n=this.getDegree(),r=t.getDegree(),o=Math.max(n,r),i=0;i<=o;i++){var s=i<=n?this.coefs[i]:0,a=i<=r?t.coefs[i]:0;e.coefs[i]=s+a}return e},d.prototype.multiply=function(t){for(var e=new d,n=0;n<=this.getDegree()+t.getDegree();n++)e.coefs.push(0);for(n=0;n<=this.getDegree();n++)for(var r=0;r<=t.getDegree();r++)e.coefs[n+r]+=this.coefs[n]*t.coefs[r];return e},d.prototype.divide_scalar=function(t){for(var e=0;e<this.coefs.length;e++)this.coefs[e]/=t},d.prototype.simplify=function(t){void 0===t&&(t=1e-12);for(var e=this.getDegree();0<=e&&Math.abs(this.coefs[e])<=t;e--)this.coefs.pop()},d.prototype.bisection=function(t,e){var n,r=this.eval(t),o=this.eval(e);if(Math.abs(r)<=d.TOLERANCE)n=t;else if(Math.abs(o)<=d.TOLERANCE)n=e;else if(r*o<=0)for(var i=Math.log(e-t),s=Math.LN10*d.ACCURACY,a=Math.ceil((i+s)/Math.LN2),u=0;u<a;u++){n=.5*(t+e);var c=this.eval(n);if(Math.abs(c)<=d.TOLERANCE)break;c*r<0?(e=n,o=c):(t=n,r=c)}return n},d.prototype.toString=function(){for(var t=new Array,e=new Array,n=this.coefs.length-1;0<=n;n--){var r=Math.round(1e3*this.coefs[n])/1e3;if(0!=r){var o=r<0?" - ":" + ";r=Math.abs(r),0<n&&(1==r?r=this._variable:r+=this._variable),1<n&&(r+="^"+n),e.push(o),t.push(r)}}e[0]=" + "==e[0]?"":"-";var i="";for(n=0;n<t.length;n++)i+=e[n]+t[n];return i},d.prototype.trapezoid=function(t,e,n){if(isNaN(t)||isNaN(e)||isNaN(n))throw new Error("Polynomial.trapezoid: parameters must be numbers");var r=e-t;if(1==n){var o=this.eval(t),i=this.eval(e);this._s=.5*r*(o+i)}else{for(var s=1<<n-2,a=r/s,u=t+.5*a,c=0,h=0;h<s;h++)c+=this.eval(u),u+=a;this._s=.5*(this._s+r*c/s)}if(isNaN(this._s))throw new Error("Polynomial.trapezoid: this._s is NaN");return this._s},d.prototype.simpson=function(t,e){if(isNaN(t)||isNaN(e))throw new Error("Polynomial.simpson: parameters must be numbers");for(var n=e-t,r=.5*n*(this.eval(t)+this.eval(e)),o=r,i=4*r/3,s=i,a=r,u=1,c=2;c<=20;c++){for(var h=n/u,l=t+.5*h,y=0,p=1;p<=u;p++)y+=this.eval(l),l+=h;if(i=(4*(r=o=.5*(o+n*y/u))-a)/3,Math.abs(i-s)<1e-7*Math.abs(s))break;s=i,a=r,u<<=1}return i},d.prototype.romberg=function(t,e){if(isNaN(t)||isNaN(e))throw new Error("Polynomial.romberg: parameters must be numbers");for(var n=new Array(21),r=new Array(21),o={y:0,dy:0},i=r[0]=1;i<=20&&(n[i-1]=this.trapezoid(t,e,i),!(3<=i&&(o=d.interpolate(r,n,3,i-3,0),Math.abs(o.dy)<=1e-6*o.y)));i++)n[i]=n[i-1],r[i]=.25*r[i-1];return o.y},d.prototype.getDegree=function(){return this.coefs.length-1},d.prototype.getDerivative=function(){for(var t=new d,e=1;e<this.coefs.length;e++)t.coefs.push(e*this.coefs[e]);return t},d.prototype.getRoots=function(){var t;switch(this.simplify(),this.getDegree()){case 0:t=[];break;case 1:t=this.getLinearRoot();break;case 2:t=this.getQuadraticRoots();break;case 3:t=this.getCubicRoots();break;case 4:t=this.getQuarticRoots();break;default:t=[]}return t},d.prototype.getRootsInInterval=function(t,e){var n,r=new Array;if(1==this.getDegree())null!=(n=this.bisection(t,e))&&r.push(n);else{var o=this.getDerivative().getRootsInInterval(t,e);if(0<o.length){for(null!=(n=this.bisection(t,o[0]))&&r.push(n),i=0;i<=o.length-2;i++)null!=(n=this.bisection(o[i],o[i+1]))&&r.push(n);null!=(n=this.bisection(o[o.length-1],e))&&r.push(n)}else null!=(n=this.bisection(t,e))&&r.push(n)}return r},d.prototype.getLinearRoot=function(){var t=[],e=this.coefs[1];return 0!=e&&t.push(-this.coefs[0]/e),t},d.prototype.getQuadraticRoots=function(){var t=[];if(2==this.getDegree()){var e=this.coefs[2],n=this.coefs[1]/e,r=n*n-4*(this.coefs[0]/e);if(0<r){var o=Math.sqrt(r);t.push(.5*(-n+o)),t.push(.5*(-n-o))}else 0==r&&t.push(.5*-n)}return t},d.prototype.getCubicRoots=function(){var t=[];if(3==this.getDegree()){var e=this.coefs[3],n=this.coefs[2]/e,r=this.coefs[1]/e,o=(3*r-n*n)/3,i=(2*n*n*n-9*r*n+27*(this.coefs[0]/e))/27,s=n/3,a=i*i/4+o*o*o/27,u=i/2,c=this.zeroErrorEstimate();if(Math.abs(a)<=c&&(a=0),0<a){var h,l=Math.sqrt(a);h=0<=(g=-u+l)?Math.pow(g,1/3):-Math.pow(-g,1/3),0<=(g=-u-l)?h+=Math.pow(g,1/3):h-=Math.pow(-g,1/3),t.push(h-s)}else if(a<0){var y=Math.sqrt(-o/3),p=Math.atan2(Math.sqrt(-a),-u)/3,f=Math.cos(p),d=Math.sin(p),v=Math.sqrt(3);t.push(2*y*f-s),t.push(-y*(f+v*d)-s),t.push(-y*(f-v*d)-s)}else{var g;g=0<=u?-Math.pow(u,1/3):Math.pow(-u,1/3),t.push(2*g-s),t.push(-g-s)}}return t};var _=function(t){return"number"==typeof t?t?t<0?-1:1:t==t?t:NaN:NaN};d.prototype.getQuarticRoots=function(){var t=[],e=this.getDegree();if(4==e){var n=new d;n.coefs=this.coefs.slice(),n.divide_scalar(n.coefs[e]);Math.abs(n.coefs[0])<10*1e-15*Math.abs(n.coefs[3])&&(n.coefs[0]=0);var r,o=n.getDerivative(),i=o.getRoots().sort(function(t,e){return t-e}),s=[],a=i.length-1,u=this.bounds();maxabsX=Math.max(Math.abs(u.minX),Math.abs(u.maxX));var c=this.zeroErrorEstimate(maxabsX);for(r=0;r<=a;r++)s.push(n.eval(i[r]));for(r=0;r<=a;r++)Math.abs(s[r])<c&&(s[r]=0);r=0;var h=Math.max(.1*(u.maxX-u.minX)/e,1e-15),l=[],y=[];if(-1<a){for(0!=s[0]?_(s[0])!=_(n.eval(i[0]-h)-s[0])&&(l.push(i[0]-h),y.push([u.minX,i[0]])):(t.push(i[0],i[0]),r++);r<a;r++)0==s[r+1]?(t.push(i[r+1],i[r+1]),r++):_(s[r])!=_(s[r+1])&&(l.push((i[r]+i[r+1])/2),y.push([i[r],i[r+1]]));0!=s[a]&&_(s[a])!=_(n.eval(i[a]+h)-s[a])&&(l.push(i[a]+h),y.push([i[a],u.maxX]))}var p=function(t){return n.eval(t)},f=function(t){return o.eval(t)};if(0<l.length)for(r=0;r<l.length;r++)l[r]=d.newton_secant_bisection(l[r],p,f,32,y[r][0],y[r][1]);t=t.concat(l)}return t},d.prototype.zeroErrorEstimate=function(o){var t=this;if(void 0===o){var e=t.bounds();o=Math.max(Math.abs(e.minX),Math.abs(e.maxX))}if(o<.001)return 2*Math.abs(t.eval(1e-15));var n=t.coefs.length-1,i=t.coefs[n];return 10*1e-15*t.coefs.reduce(function(t,e,n){var r=e/i*Math.pow(o,n);return t<r?r:t},0)},d.prototype.bounds_UpperReal_Fujiwara=function(){var e=this.coefs,n=e.length-1,r=e[n];1!=r&&(e=this.coefs.map(function(t){return t/r}));var o,t=e.map(function(t,e){return e<n?Math.pow(Math.abs(0==e?t/2:t),1/(n-e)):t}),i=function(t,e,n){return o(n)&&(t.max<e?(t.nearmax=t.max,t.max=e):t.nearmax<e&&(t.nearmax=e)),t};o=function(t){return t<n&&e[t]<0};var s=t.reduce(i,{max:0,nearmax:0});return o=function(t){return t<n&&(n%2==t%2?e[t]<0:0<e[t])},{negX:-2*t.reduce(i,{max:0,nearmax:0}).max,posX:2*s.max}},d.prototype.bounds_LowerReal_Fujiwara=function(){var t=new d;t.coefs=this.coefs.slice().reverse();var e=t.bounds_UpperReal_Fujiwara();return e.negX=1/e.negX,e.posX=1/e.posX,e},d.prototype.bounds=function(){var t=this.bounds_UpperReal_Fujiwara(),e={minX:t.negX,maxX:t.posX};return 0===t.negX&&0===t.posX||(0===t.negX?e.minX=this.bounds_LowerReal_Fujiwara().posX:0===t.posX&&(e.maxX=this.bounds_LowerReal_Fujiwara().negX),e.minX>e.maxX&&(e.minX=e.maxX=0)),e},d.newton_secant_bisection=function(t,e,n,r,o,i){var s,a,u,c,h,l,p=0,f=0;s=t;var d=Math.pow(10,-14),v="number"==typeof o&&"number"==typeof i;if(v){if(i<o)throw new Error("newton root finding: min must be greater than max");if(h=e(o),l=e(i),_(h)==_(l))throw new Error("newton root finding: y values of bounds must be of opposite sign")}var g,m=function(){return Math.abs(u)<=d*Math.abs(s)||f==s-u-s};for(g=0;g<r;g++){if(0==(a=n(s))){if(0==p)throw new Error("newton root finding: df(x) is zero");a=p}if(p=a,y=e(s),u=y/a,c=s-u,m())break;if(v){if(_(y)==_(l))i=s,l=y;else{if(_(y)!=_(h)){s=c;break}o=s,h=y}if(c<o||i<c){if(_(h)==_(l))break;var x=l-h,b=i-o;if(u=0==x?s-(o+.5*b):50<Math.abs(x/Math.min(h,l))?s-(o+b*(.5+(Math.abs(h)<Math.abs(l)?-.25:.25))):s-(o-h/x*b),c=s-u,m())break}}f=s-c,s=c}return s},t.exports=d}),s=n(function(t){var e=o;function n(){this.init(arguments)}n.VERSION=1,((n.prototype=new e).constructor=n).superclass=e.prototype,n.prototype.eval=function(t){var e=n.superclass.eval.call(this,t);if(Math.abs(e)<1e-7&&(e=0),e<0)throw new Error("SqrtPolynomial.eval: cannot take square root of negative number");return Math.sqrt(e)},n.prototype.toString=function(){return"sqrt("+n.superclass.toString.call(this)+")"},t.exports=n}),a={Polynomial:o,SqrtPolynomial:s},u=n(function(t){var F=r.Point2D,tt=r.Vector2D,et=a.Polynomial;function i(t){var e=t.slice();return e.push(t[0]),e}function nt(t){this.init(t)}nt.prototype.init=function(t){this.status=t,this.points=new Array},nt.prototype.appendPoint=function(t){this.points.push(t)},nt.prototype.appendPoints=function(t){this.points=this.points.concat(t)},nt.intersect=function(t,e){var n;if(null!=t&&null!=e)if("Path"==t.name)n=nt.intersectPathShape(t,e);else if("Path"==e.name)n=nt.intersectPathShape(e,t);else{var r,o;if(t.name<e.name?(r="intersect"+t.name+e.name,o=t.args.concat(e.args)):(r="intersect"+e.name+t.name,o=e.args.concat(t.args)),!(r in nt))throw new Error("Intersection not available: "+r);n=nt[r].apply(null,o)}else n=new nt("No Intersection");return n},nt.intersectPathShape=function(t,e){for(var n=new nt("No Intersection"),r=t.args.length,o=0;o<r;o++){var i=t.args[o],s=nt.intersect(i,e);n.appendPoints(s.points)}return 0<n.points.length&&(n.status="Intersection"),n},nt.intersectBezier2Bezier2=function(t,e,n,r,o,i){var s,a,u,c,h,l,y=new nt("No Intersection");p=e.multiply(-2),s=t.add(p.add(n)),p=t.multiply(-2),f=e.multiply(2),a=p.add(f),u=new F(t.x,t.y),p=o.multiply(-2),c=r.add(p.add(i)),p=r.multiply(-2),f=o.multiply(2),h=p.add(f),l=new F(r.x,r.y);for(var p=s.x*a.y-a.x*s.y,f=c.x*a.y-a.x*c.y,d=h.x*a.y-a.x*h.y,v=a.x*(u.y-l.y)+a.y*(-u.x+l.x),g=c.x*s.y-s.x*c.y,m=h.x*s.y-s.x*h.y,x=s.x*(u.y-l.y)+s.y*(-u.x+l.x),b=new et(-g*g,-2*g*m,p*f-m*m-2*g*x,p*d-2*m*x,p*v-x*x).getRoots(),_=0;_<b.length;_++){var w=b[_];if(0<=w&&w<=1){var P=new et(s.x,a.x,u.x-l.x-w*h.x-w*w*c.x);P.simplify();var S=P.getRoots(),M=new et(s.y,a.y,u.y-l.y-w*h.y-w*w*c.y);M.simplify();var k=M.getRoots();if(0<S.length&&0<k.length){t:for(var E=0;E<S.length;E++){var L=S[E];if(0<=L&&L<=1)for(var I=0;I<k.length;I++)if(Math.abs(L-k[I])<1e-4){y.points.push(c.multiply(w*w).add(h.multiply(w).add(l)));break t}}}}}return 0<y.points.length&&(y.status="Intersection"),y},nt.intersectBezier2Bezier3=function(t,e,n,r,o,i,s){var a,u,c,h,l,y,p,f,d,v,g,m=new nt("No Intersection");a=e.multiply(-2),l=t.add(a.add(n)),a=t.multiply(-2),u=e.multiply(2),y=a.add(u),p=new F(t.x,t.y),a=r.multiply(-1),u=o.multiply(3),c=i.multiply(-3),h=a.add(u.add(c.add(s))),f=new tt(h.x,h.y),a=r.multiply(3),u=o.multiply(-6),c=i.multiply(3),h=a.add(u.add(c)),d=new tt(h.x,h.y),a=r.multiply(-3),u=o.multiply(3),c=a.add(u),v=new tt(c.x,c.y),g=new tt(r.x,r.y);for(var x=p.x*p.x,b=p.y*p.y,_=y.x*y.x,w=y.y*y.y,P=l.x*l.x,S=l.y*l.y,M=g.x*g.x,k=g.y*g.y,E=v.x*v.x,L=v.y*v.y,I=d.x*d.x,C=d.y*d.y,j=f.x*f.x,T=f.y*f.y,O=new et(-2*l.x*l.y*f.x*f.y+P*T+S*j,-2*l.x*l.y*d.x*f.y-2*l.x*l.y*d.y*f.x+2*S*d.x*f.x+2*P*d.y*f.y,-2*l.x*v.x*l.y*f.y-2*l.x*l.y*v.y*f.x-2*l.x*l.y*d.x*d.y+2*v.x*S*f.x+S*I+P*(2*v.y*f.y+C),2*p.x*l.x*l.y*f.y+2*p.y*l.x*l.y*f.x+y.x*y.y*l.x*f.y+y.x*y.y*l.y*f.x-2*g.x*l.x*l.y*f.y-2*l.x*g.y*l.y*f.x-2*l.x*v.x*l.y*d.y-2*l.x*l.y*v.y*d.x-2*p.x*S*f.x-2*p.y*P*f.y+2*g.x*S*f.x+2*v.x*S*d.x-w*l.x*f.x-_*l.y*f.y+P*(2*g.y*f.y+2*v.y*d.y),2*p.x*l.x*l.y*d.y+2*p.y*l.x*l.y*d.x+y.x*y.y*l.x*d.y+y.x*y.y*l.y*d.x-2*g.x*l.x*l.y*d.y-2*l.x*g.y*l.y*d.x-2*l.x*v.x*l.y*v.y-2*p.x*S*d.x-2*p.y*P*d.y+2*g.x*S*d.x-w*l.x*d.x-_*l.y*d.y+E*S+P*(2*g.y*d.y+L),2*p.x*l.x*l.y*v.y+2*p.y*l.x*v.x*l.y+y.x*y.y*l.x*v.y+y.x*y.y*v.x*l.y-2*g.x*l.x*l.y*v.y-2*l.x*g.y*v.x*l.y-2*p.x*v.x*S-2*p.y*P*v.y+2*g.x*v.x*S-w*l.x*v.x-_*l.y*v.y+2*P*g.y*v.y,-2*p.x*p.y*l.x*l.y-p.x*y.x*y.y*l.y-p.y*y.x*y.y*l.x+2*p.x*l.x*g.y*l.y+2*p.y*g.x*l.x*l.y+y.x*g.x*y.y*l.y+y.x*y.y*l.x*g.y-2*g.x*l.x*g.y*l.y-2*p.x*g.x*S+p.x*w*l.x+p.y*_*l.y-2*p.y*P*g.y-g.x*w*l.x-_*g.y*l.y+x*S+b*P+M*S+P*k).getRootsInInterval(0,1),R=0;R<O.length;R++){var N=O[R],z=new et(l.x,y.x,p.x-g.x-N*v.x-N*N*d.x-N*N*N*f.x).getRoots(),A=new et(l.y,y.y,p.y-g.y-N*v.y-N*N*d.y-N*N*N*f.y).getRoots();if(0<z.length&&0<A.length){t:for(var G=0;G<z.length;G++){var B=z[G];if(0<=B&&B<=1)for(var D=0;D<A.length;D++)if(Math.abs(B-A[D])<1e-4){m.points.push(f.multiply(N*N*N).add(d.multiply(N*N).add(v.multiply(N).add(g))));break t}}}}return 0<m.points.length&&(m.status="Intersection"),m},nt.intersectBezier2Circle=function(t,e,n,r,o){return nt.intersectBezier2Ellipse(t,e,n,r,o,o)},nt.intersectBezier2Ellipse=function(t,e,n,r,o,i){var s,a,u,c,h,l=new nt("No Intersection");s=e.multiply(-2),u=t.add(s.add(n)),s=t.multiply(-2),a=e.multiply(2),c=s.add(a),h=new F(t.x,t.y);for(var y=o*o,p=i*i,f=new et(p*u.x*u.x+y*u.y*u.y,2*(p*u.x*c.x+y*u.y*c.y),p*(2*u.x*h.x+c.x*c.x)+y*(2*u.y*h.y+c.y*c.y)-2*(p*r.x*u.x+y*r.y*u.y),2*(p*c.x*(h.x-r.x)+y*c.y*(h.y-r.y)),p*(h.x*h.x+r.x*r.x)+y*(h.y*h.y+r.y*r.y)-2*(p*r.x*h.x+y*r.y*h.y)-y*p).getRoots(),d=0;d<f.length;d++){var v=f[d];0<=v&&v<=1&&l.points.push(u.multiply(v*v).add(c.multiply(v).add(h)))}return 0<l.points.length&&(l.status="Intersection"),l},nt.intersectBezier2Line=function(t,e,n,r,o){var i,s,a,u,c,h,l,y=r.min(o),p=r.max(o),f=new nt("No Intersection");i=e.multiply(-2),a=t.add(i.add(n)),i=t.multiply(-2),s=e.multiply(2),u=i.add(s),c=new F(t.x,t.y),l=new tt(r.y-o.y,o.x-r.x),h=r.x*o.y-o.x*r.y,roots=new et(l.dot(a),l.dot(u),l.dot(c)+h).getRoots();for(var d=0;d<roots.length;d++){var v=roots[d];if(0<=v&&v<=1){var g=t.lerp(e,v),m=e.lerp(n,v),x=g.lerp(m,v);r.x==o.x?y.y<=x.y&&x.y<=p.y&&(f.status="Intersection",f.appendPoint(x)):r.y==o.y?y.x<=x.x&&x.x<=p.x&&(f.status="Intersection",f.appendPoint(x)):y.x<=x.x&&x.x<=p.x&&y.y<=x.y&&x.y<=p.y&&(f.status="Intersection",f.appendPoint(x))}}return f},nt.intersectBezier2Polygon=function(t,e,n,r){return nt.intersectBezier2Polyline(t,e,n,i(r))},nt.intersectBezier2Polyline=function(t,e,n,r){for(var o=new nt("No Intersection"),i=r.length,s=0;s<i-1;s++){var a=r[s],u=r[s+1],c=nt.intersectBezier2Line(t,e,n,a,u);o.appendPoints(c.points)}return 0<o.points.length&&(o.status="Intersection"),o},nt.intersectBezier2Rectangle=function(t,e,n,r,o){var i=r.min(o),s=r.max(o),a=new F(s.x,i.y),u=new F(i.x,s.y),c=nt.intersectBezier2Line(t,e,n,i,a),h=nt.intersectBezier2Line(t,e,n,a,s),l=nt.intersectBezier2Line(t,e,n,s,u),y=nt.intersectBezier2Line(t,e,n,u,i),p=new nt("No Intersection");return p.appendPoints(c.points),p.appendPoints(h.points),p.appendPoints(l.points),p.appendPoints(y.points),0<p.points.length&&(p.status="Intersection"),p},nt.intersectBezier3Bezier3=function(t,e,n,r,o,i,s,a){var u,c,h,l,y,p,f,d,v,g=new nt("No Intersection");m=t.multiply(-1),x=e.multiply(3),u=n.multiply(-3),S=m.add(x.add(u.add(r))),c=new tt(S.x,S.y),m=t.multiply(3),x=e.multiply(-6),u=n.multiply(3),S=m.add(x.add(u)),h=new tt(S.x,S.y),m=t.multiply(-3),x=e.multiply(3),u=m.add(x),l=new tt(u.x,u.y),y=new tt(t.x,t.y),m=o.multiply(-1),x=i.multiply(3),u=s.multiply(-3),S=m.add(x.add(u.add(a))),p=new tt(S.x,S.y),m=o.multiply(3),x=i.multiply(-6),u=s.multiply(3),S=m.add(x.add(u)),f=new tt(S.x,S.y),m=o.multiply(-3),x=i.multiply(3),u=m.add(x),d=new tt(u.x,u.y),v=new tt(o.x,o.y);var m=c.x*h.y-h.x*c.y,x=c.x*l.y-l.x*c.y,b=c.x*y.y-y.x*c.y+v.x*c.y-c.x*v.y,_=d.x*c.y-c.x*d.y,w=f.x*c.y-c.x*f.y,P=p.x*c.y-c.x*p.y,S=c.x*l.y-l.x*c.y,M=c.x*y.y+h.x*l.y-l.x*h.y-y.x*c.y+v.x*c.y-c.x*v.y,k=d.x*c.y-c.x*d.y,E=f.x*c.y-c.x*f.y,L=p.x*c.y-c.x*p.y,I=h.x*y.y-y.x*h.y+v.x*h.y-h.x*v.y,C=d.x*h.y-h.x*d.y,j=f.x*h.y-h.x*f.y,T=p.x*h.y-h.x*p.y,O=c.x*y.y-y.x*c.y+v.x*c.y-c.x*v.y,R=d.x*c.y-c.x*d.y,N=f.x*c.y-c.x*f.y,z=p.x*c.y-c.x*p.y,A=h.x*y.y-y.x*h.y+v.x*h.y-h.x*v.y,G=d.x*h.y-h.x*d.y,B=f.x*h.y-h.x*f.y,D=p.x*h.y-h.x*p.y,F=l.x*y.y-y.x*l.y+v.x*l.y-l.x*v.y,W=d.x*l.y-l.x*d.y,X=f.x*l.y-l.x*f.y,q=p.x*l.y-l.x*p.y,U=new et(-P*L*z,-P*L*N-P*E*z-w*L*z,-P*L*R-P*E*N-w*L*N-P*k*z-w*E*z-_*L*z,-P*L*O-P*E*R-w*L*R-P*k*N-w*E*N-_*L*N-P*M*z-w*k*z-_*E*z-b*L*z+x*T*z+P*S*D-m*T*D+m*L*q,-P*E*O-w*L*O-P*k*R-w*E*R-_*L*R-P*M*N-w*k*N-_*E*N-b*L*N+x*T*N-w*M*z-_*k*z-b*E*z+x*j*z+P*S*B-m*T*B+w*S*D-m*j*D+m*L*X+m*E*q,-P*k*O-w*E*O-_*L*O-P*M*R-w*k*R-_*E*R-b*L*R+x*T*R-w*M*N-_*k*N-b*E*N+x*j*N-_*M*z-b*k*z+x*C*z+P*S*G-m*T*G+w*S*B-m*j*B+_*S*D-m*C*D+m*L*W+m*E*X+m*k*q,-P*M*O-w*k*O-_*E*O-b*L*O+x*T*O-w*M*R-_*k*R-b*E*R+x*j*R-_*M*N-b*k*N+x*C*N-b*M*z+x*I*z+P*S*A-m*T*A+w*S*G-m*j*G+_*S*B-m*C*B+b*S*D-m*I*D+m*L*F+m*E*W+m*k*X-x*S*q+m*M*q,-w*M*O-_*k*O-b*E*O+x*j*O-_*M*R-b*k*R+x*C*R-b*M*N+x*I*N+w*S*A-m*j*A+_*S*G-m*C*G+b*S*B-m*I*B+m*E*F+m*k*W-x*S*X+m*M*X,-_*M*O-b*k*O+x*C*O-b*M*R+x*I*R+_*S*A-m*C*A+b*S*G-m*I*G+m*k*F-x*S*W+m*M*W,-b*M*O+x*I*O+b*S*A-m*I*A-x*S*F+m*M*F);U.simplify();for(var V=U.getRootsInInterval(0,1),Y=0;Y<V.length;Y++){var H=V[Y],$=new et(c.x,h.x,l.x,y.x-v.x-H*d.x-H*H*f.x-H*H*H*p.x);$.simplify(),xRoots=$.getRoots();var J=new et(c.y,h.y,l.y,y.y-v.y-H*d.y-H*H*f.y-H*H*H*p.y);if(J.simplify(),yRoots=J.getRoots(),0<xRoots.length&&0<yRoots.length){t:for(var Q=0;Q<xRoots.length;Q++){var Z=xRoots[Q];if(0<=Z&&Z<=1)for(var K=0;K<yRoots.length;K++)if(Math.abs(Z-yRoots[K])<1e-4){g.points.push(p.multiply(H*H*H).add(f.multiply(H*H).add(d.multiply(H).add(v))));break t}}}}return 0<g.points.length&&(g.status="Intersection"),g},nt.intersectBezier3Circle=function(t,e,n,r,o,i){return nt.intersectBezier3Ellipse(t,e,n,r,o,i,i)},nt.intersectBezier3Ellipse=function(t,e,n,r,o,i,s){var a,u,c,h,l,y,p,f,d=new nt("No Intersection");a=t.multiply(-1),u=e.multiply(3),c=n.multiply(-3),h=a.add(u.add(c.add(r))),l=new tt(h.x,h.y),a=t.multiply(3),u=e.multiply(-6),c=n.multiply(3),h=a.add(u.add(c)),y=new tt(h.x,h.y),a=t.multiply(-3),u=e.multiply(3),c=a.add(u),p=new tt(c.x,c.y),f=new tt(t.x,t.y);for(var v=i*i,g=s*s,m=new et(l.x*l.x*g+l.y*l.y*v,2*(l.x*y.x*g+l.y*y.y*v),2*(l.x*p.x*g+l.y*p.y*v)+y.x*y.x*g+y.y*y.y*v,2*l.x*g*(f.x-o.x)+2*l.y*v*(f.y-o.y)+2*(y.x*p.x*g+y.y*p.y*v),2*y.x*g*(f.x-o.x)+2*y.y*v*(f.y-o.y)+p.x*p.x*g+p.y*p.y*v,2*p.x*g*(f.x-o.x)+2*p.y*v*(f.y-o.y),f.x*f.x*g-2*f.y*o.y*v-2*f.x*o.x*g+f.y*f.y*v+o.x*o.x*g+o.y*o.y*v-v*g).getRootsInInterval(0,1),x=0;x<m.length;x++){var b=m[x];d.points.push(l.multiply(b*b*b).add(y.multiply(b*b).add(p.multiply(b).add(f))))}return 0<d.points.length&&(d.status="Intersection"),d},nt.intersectBezier3Line=function(t,e,n,r,o,i){var s,a,u,c,h,l,y,p,f,d,v=o.min(i),g=o.max(i),m=new nt("No Intersection");s=t.multiply(-1),a=e.multiply(3),u=n.multiply(-3),c=s.add(a.add(u.add(r))),h=new tt(c.x,c.y),s=t.multiply(3),a=e.multiply(-6),u=n.multiply(3),c=s.add(a.add(u)),l=new tt(c.x,c.y),s=t.multiply(-3),a=e.multiply(3),u=s.add(a),y=new tt(u.x,u.y),p=new tt(t.x,t.y),d=new tt(o.y-i.y,i.x-o.x),f=o.x*i.y-i.x*o.y,roots=new et(d.dot(h),d.dot(l),d.dot(y),d.dot(p)+f).getRoots();for(var x=0;x<roots.length;x++){var b=roots[x];if(0<=b&&b<=1){var _=t.lerp(e,b),w=e.lerp(n,b),P=n.lerp(r,b),S=_.lerp(w,b),M=w.lerp(P,b),k=S.lerp(M,b);o.x==i.x?v.y<=k.y&&k.y<=g.y&&(m.status="Intersection",m.appendPoint(k)):o.y==i.y?v.x<=k.x&&k.x<=g.x&&(m.status="Intersection",m.appendPoint(k)):v.x<=k.x&&k.x<=g.x&&v.y<=k.y&&k.y<=g.y&&(m.status="Intersection",m.appendPoint(k))}}return m},nt.intersectBezier3Polygon=function(t,e,n,r,o){return this.intersectBezier3Polyline(t,e,n,r,i(o))},nt.intersectBezier3Polyline=function(t,e,n,r,o){for(var i=new nt("No Intersection"),s=o.length,a=0;a<s-1;a++){var u=o[a],c=o[a+1],h=nt.intersectBezier3Line(t,e,n,r,u,c);i.appendPoints(h.points)}return 0<i.points.length&&(i.status="Intersection"),i},nt.intersectBezier3Rectangle=function(t,e,n,r,o,i){var s=o.min(i),a=o.max(i),u=new F(a.x,s.y),c=new F(s.x,a.y),h=nt.intersectBezier3Line(t,e,n,r,s,u),l=nt.intersectBezier3Line(t,e,n,r,u,a),y=nt.intersectBezier3Line(t,e,n,r,a,c),p=nt.intersectBezier3Line(t,e,n,r,c,s),f=new nt("No Intersection");return f.appendPoints(h.points),f.appendPoints(l.points),f.appendPoints(y.points),f.appendPoints(p.points),0<f.points.length&&(f.status="Intersection"),f},nt.intersectCircleCircle=function(t,e,n,r){var o,i=e+r,s=Math.abs(e-r),a=t.distanceFrom(n);if(i<a)o=new nt("Outside");else if(a<s)o=new nt("Inside");else{o=new nt("Intersection");var u=(e*e-r*r+a*a)/(2*a),c=Math.sqrt(e*e-u*u),h=t.lerp(n,u/a),l=c/a;o.points.push(new F(h.x-l*(n.y-t.y),h.y+l*(n.x-t.x))),o.points.push(new F(h.x+l*(n.y-t.y),h.y-l*(n.x-t.x)))}return o},nt.intersectCircleEllipse=function(t,e,n,r,o){return nt.intersectEllipseEllipse(t,e,e,n,r,o)},nt.intersectCircleLine=function(t,e,n,r){var o,i=(r.x-n.x)*(r.x-n.x)+(r.y-n.y)*(r.y-n.y),s=2*((r.x-n.x)*(n.x-t.x)+(r.y-n.y)*(n.y-t.y)),a=s*s-4*i*(t.x*t.x+t.y*t.y+n.x*n.x+n.y*n.y-2*(t.x*n.x+t.y*n.y)-e*e);if(a<0)o=new nt("Outside");else if(0==a)o=new nt("Tangent");else{var u=Math.sqrt(a),c=(-s+u)/(2*i),h=(-s-u)/(2*i);(c<0||1<c)&&(h<0||1<h)?o=new nt(c<0&&h<0||1<c&&1<h?"Outside":"Inside"):(o=new nt("Intersection"),0<=c&&c<=1&&o.points.push(n.lerp(r,c)),0<=h&&h<=1&&o.points.push(n.lerp(r,h)))}return o},nt.intersectCirclePolygon=function(t,e,n){return this.intersectCirclePolyline(t,e,i(n))},nt.intersectCirclePolyline=function(t,e,n){for(var r,o=new nt("No Intersection"),i=n.length,s=0;s<i-1;s++){var a=n[s],u=n[s+1];r=nt.intersectCircleLine(t,e,a,u),o.appendPoints(r.points)}return 0<o.points.length?o.status="Intersection":o.status=r.status,o},nt.intersectCircleRectangle=function(t,e,n,r){var o=n.min(r),i=n.max(r),s=new F(i.x,o.y),a=new F(o.x,i.y),u=nt.intersectCircleLine(t,e,o,s),c=nt.intersectCircleLine(t,e,s,i),h=nt.intersectCircleLine(t,e,i,a),l=nt.intersectCircleLine(t,e,a,o),y=new nt("No Intersection");return y.appendPoints(u.points),y.appendPoints(c.points),y.appendPoints(h.points),y.appendPoints(l.points),0<y.points.length?y.status="Intersection":y.status=u.status,y},nt.intersectEllipseEllipse=function(t,e,n,r,o,i){for(var s=[n*n,0,e*e,-2*n*n*t.x,-2*e*e*t.y,n*n*t.x*t.x+e*e*t.y*t.y-e*e*n*n],a=[i*i,0,o*o,-2*i*i*r.x,-2*o*o*r.y,i*i*r.x*r.x+o*o*r.y*r.y-o*o*i*i],u=nt.bezout(s,a).getRoots(),c=.001*(s[0]*s[0]+2*s[1]*s[1]+s[2]*s[2]),h=.001*(a[0]*a[0]+2*a[1]*a[1]+a[2]*a[2]),l=new nt("No Intersection"),y=0;y<u.length;y++)for(var p=new et(s[0],s[3]+u[y]*s[1],s[5]+u[y]*(s[4]+u[y]*s[2])).getRoots(),f=0;f<p.length;f++){var d=(s[0]*p[f]+s[1]*u[y]+s[3])*p[f]+(s[2]*u[y]+s[4])*u[y]+s[5];Math.abs(d)<c&&(d=(a[0]*p[f]+a[1]*u[y]+a[3])*p[f]+(a[2]*u[y]+a[4])*u[y]+a[5],Math.abs(d)<h&&l.appendPoint(new F(p[f],u[y])))}return 0<l.points.length&&(l.status="Intersection"),l},nt.intersectEllipseLine=function(t,e,n,r,o){var i,s=new tt(r.x,r.y),a=tt.fromPoints(r,o),u=new tt(t.x,t.y),c=s.subtract(u),h=new tt(a.x/(e*e),a.y/(n*n)),l=new tt(c.x/(e*e),c.y/(n*n)),y=a.dot(h),p=a.dot(l),f=p*p-y*(t=c.dot(l)-1);if(f<0)i=new nt("Outside");else if(0<f){var d=Math.sqrt(f),v=(-p-d)/y,g=(-p+d)/y;(v<0||1<v)&&(g<0||1<g)?i=new nt(v<0&&g<0||1<v&&1<g?"Outside":"Inside"):(i=new nt("Intersection"),0<=v&&v<=1&&i.appendPoint(r.lerp(o,v)),0<=g&&g<=1&&i.appendPoint(r.lerp(o,g)))}else{var m=-p/y;0<=m&&m<=1?(i=new nt("Intersection")).appendPoint(r.lerp(o,m)):i=new nt("Outside")}return i},nt.intersectEllipsePolygon=function(t,e,n,r){return this.intersectEllipsePolyline(t,e,n,i(r))},nt.intersectEllipsePolyline=function(t,e,n,r){for(var o=new nt("No Intersection"),i=r.length,s=0;s<i-1;s++){var a=r[s],u=r[s+1],c=nt.intersectEllipseLine(t,e,n,a,u);o.appendPoints(c.points)}return 0<o.points.length&&(o.status="Intersection"),o},nt.intersectEllipseRectangle=function(t,e,n,r,o){var i=r.min(o),s=r.max(o),a=new F(s.x,i.y),u=new F(i.x,s.y),c=nt.intersectEllipseLine(t,e,n,i,a),h=nt.intersectEllipseLine(t,e,n,a,s),l=nt.intersectEllipseLine(t,e,n,s,u),y=nt.intersectEllipseLine(t,e,n,u,i),p=new nt("No Intersection");return p.appendPoints(c.points),p.appendPoints(h.points),p.appendPoints(l.points),p.appendPoints(y.points),0<p.points.length&&(p.status="Intersection"),p},nt.intersectLineLine=function(t,e,n,r){var o,i=(r.x-n.x)*(t.y-n.y)-(r.y-n.y)*(t.x-n.x),s=(e.x-t.x)*(t.y-n.y)-(e.y-t.y)*(t.x-n.x),a=(r.y-n.y)*(e.x-t.x)-(r.x-n.x)*(e.y-t.y);if(0!=a){var u=i/a,c=s/a;0<=u&&u<=1&&0<=c&&c<=1?(o=new nt("Intersection")).points.push(new F(t.x+u*(e.x-t.x),t.y+u*(e.y-t.y))):o=new nt("No Intersection")}else o=new nt(0==i||0==s?"Coincident":"Parallel");return o},nt.intersectLinePolygon=function(t,e,n){return this.intersectLinePolyline(t,e,i(n))},nt.intersectLinePolyline=function(t,e,n){for(var r=new nt("No Intersection"),o=n.length,i=0;i<o-1;i++){var s=n[i],a=n[i+1],u=nt.intersectLineLine(t,e,s,a);r.appendPoints(u.points)}return 0<r.points.length&&(r.status="Intersection"),r},nt.intersectLineRectangle=function(t,e,n,r){var o=n.min(r),i=n.max(r),s=new F(i.x,o.y),a=new F(o.x,i.y),u=nt.intersectLineLine(o,s,t,e),c=nt.intersectLineLine(s,i,t,e),h=nt.intersectLineLine(i,a,t,e),l=nt.intersectLineLine(a,o,t,e),y=new nt("No Intersection");return y.appendPoints(u.points),y.appendPoints(c.points),y.appendPoints(h.points),y.appendPoints(l.points),0<y.points.length&&(y.status="Intersection"),y},nt.intersectPolygonPolygon=function(t,e){return this.intersectPolylinePolyline(i(t),i(e))},nt.intersectPolygonPolyline=function(t,e){return this.intersectPolylinePolyline(i(t),e)},nt.intersectPolygonRectangle=function(t,e,n){return this.intersectPolylineRectangle(i(t),e,n)},nt.intersectPolylinePolyline=function(t,e){for(var n=new nt("No Intersection"),r=t.length,o=0;o<r-1;o++){var i=t[o],s=t[o+1],a=nt.intersectLinePolyline(i,s,e);n.appendPoints(a.points)}return 0<n.points.length&&(n.status="Intersection"),n},nt.intersectPolylineRectangle=function(t,e,n){var r=e.min(n),o=e.max(n),i=new F(o.x,r.y),s=new F(r.x,o.y),a=nt.intersectLinePolyline(r,i,t),u=nt.intersectLinePolyline(i,o,t),c=nt.intersectLinePolyline(o,s,t),h=nt.intersectLinePolyline(s,r,t),l=new nt("No Intersection");return l.appendPoints(a.points),l.appendPoints(u.points),l.appendPoints(c.points),l.appendPoints(h.points),0<l.points.length&&(l.status="Intersection"),l},nt.intersectRectangleRectangle=function(t,e,n,r){var o=t.min(e),i=t.max(e),s=new F(i.x,o.y),a=new F(o.x,i.y),u=nt.intersectLineRectangle(o,s,n,r),c=nt.intersectLineRectangle(s,i,n,r),h=nt.intersectLineRectangle(i,a,n,r),l=nt.intersectLineRectangle(a,o,n,r),y=new nt("No Intersection");return y.appendPoints(u.points),y.appendPoints(c.points),y.appendPoints(h.points),y.appendPoints(l.points),0<y.points.length&&(y.status="Intersection"),y},nt.intersectRayRay=function(t,e,n,r){var o,i=(r.x-n.x)*(t.y-n.y)-(r.y-n.y)*(t.x-n.x),s=(e.x-t.x)*(t.y-n.y)-(e.y-t.y)*(t.x-n.x),a=(r.y-n.y)*(e.x-t.x)-(r.x-n.x)*(e.y-t.y);if(0!=a){var u=i/a;(o=new nt("Intersection")).points.push(new F(t.x+u*(e.x-t.x),t.y+u*(e.y-t.y)))}else o=new nt(0==i||0==s?"Coincident":"Parallel");return o},nt.bezout=function(t,e){var n=t[0]*e[1]-e[0]*t[1],r=t[0]*e[2]-e[0]*t[2],o=t[0]*e[3]-e[0]*t[3],i=t[0]*e[4]-e[0]*t[4],s=t[0]*e[5]-e[0]*t[5],a=t[1]*e[2]-e[1]*t[2],u=t[1]*e[4]-e[1]*t[4],c=t[1]*e[5]-e[1]*t[5],h=t[2]*e[3]-e[2]*t[3],l=t[3]*e[4]-e[3]*t[4],y=t[3]*e[5]-e[3]*t[5],p=c+l,f=u-h;return new et(n*a-r*r,n*f+o*a-2*r*i,n*p+o*f-i*i-2*r*s,n*y+o*p-2*i*s,o*y-s*s)},t.exports=nt}),h=n(function(t){function e(t,e){this.init(t,e)}e.prototype.init=function(t,e){this.name=t,this.args=e},t.exports=e}),g=(n(function(t){var u=r.Point2D,c=h,e={quadraticBezier:function(t,e,n,r,o,i){return new c("Bezier2",[new u(t,e),new u(n,r),new u(o,i)])},cubicBezier:function(t,e,n,r,o,i,s,a){return new c("Bezier3",[new u(t,e),new u(n,r),new u(o,i),new u(s,a)])},circle:function(t,e,n){return new c("Circle",[new u(t,e),n])},ellipse:function(t,e,n,r){return new c("Ellipse",[new u(t,e),n,r])},line:function(t,e,n,r){return new c("Line",[new u(t,e),new u(n,r)])},path:function(t){return new c("Path",t)},polygon:function(t){for(var e=[],n=0;n<t.length;n+=2)e.push(new u(t[n],t[n+1]));return new c("Polygon",[e])},polyline:function(t){for(var e=[],n=0;n<t.length;n+=2)e.push(new u(t[n],t[n+1]));return new c("Polyline",[e])},rectangle:function(t,e,n,r){return new c("Rectangle",[new u(t,e),new u(t+n,e+r)])}};t.exports=e}),n(function(t){var o=h,e={quadraticBezier:function(t,e,n){return new o("Bezier2",[t,e,n])},cubicBezier:function(t,e,n,r){return new o("Bezier3",[t,e,n,r])},circle:function(t,e){return new o("Circle",[t,e])},ellipse:function(t,e,n){return new o("Ellipse",[t,e,n])},line:function(t,e){return new o("Line",[t,e])},path:function(t){return new o("Path",[t])},polygon:function(t){return new o("Polygon",[t])},polyline:function(t){return new o("Polyline",[t])},rectangle:function(t,e){return new o("Rectangle",[t,t.add(e)])}};t.exports=e}),n(function(t){var e={pointInCircle:function(t,e,n){return Vector2D.fromPoints(e,t).length()<=n},pointInEllipse:function(t,e,n,r){var o=t.subtract(e);return o.x*o.x/(n*n)+o.y*o.y/(r*r)<=1},pointInPolyline:function(t,e){for(var n,r=e.length,o=0,i=e[0],s=1;s<=r;s++){var a=e[s%r],u=Math.min(i.y,a.y),c=Math.max(i.y,a.y),h=Math.max(i.x,a.x);i.y!=a.y&&u<t.y&&t.y<=c&&t.x<=h&&(n=(t.y-i.y)*(a.x-i.x)/(a.y-i.y)+i.x,(i.x==a.x||t.x<=n)&&o++),i=a}return o%2==1}};e.pointInPolygon=e.pointInPolyline,e.pointInRectangle=function(t,e,n){return e.x<=t.x&&t.x<n.x&&topleft.y<=t.y&&t.y<n.y},t.exports=e}),u);var c=function(){this.__data__=[],this.size=0};var l=function(t,e){return t===e||t!=t&&e!=e};var p=function(t,e){for(var n=t.length;n--;)if(l(t[n][0],e))return n;return-1},f=Array.prototype.splice;var d=function(t){var e=this.__data__,n=p(e,t);return!(n<0||(n==e.length-1?e.pop():f.call(e,n,1),--this.size,0))};var v=function(t){var e=this.__data__,n=p(e,t);return n<0?void 0:e[n][1]};var m=function(t){return-1<p(this.__data__,t)};var x=function(t,e){var n=this.__data__,r=p(n,t);return r<0?(++this.size,n.push([t,e])):n[r][1]=e,this};function b(t){var e=-1,n=null==t?0:t.length;for(this.clear();++e<n;){var r=t[e];this.set(r[0],r[1])}}b.prototype.clear=c,b.prototype.delete=d,b.prototype.get=v,b.prototype.has=m,b.prototype.set=x;var _=b;var w=function(){this.__data__=new _,this.size=0};var P=function(t){var e=this.__data__,n=e.delete(t);return this.size=e.size,n};var S=function(t){return this.__data__.get(t)};var M=function(t){return this.__data__.has(t)},k="object"==("function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(e)&&e&&e.Object===Object&&e,E="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},L="object"==("undefined"==typeof self?"undefined":E(self))&&self&&self.Object===Object&&self,I=k||L||Function("return this")(),C=I.Symbol,j=Object.prototype,T=j.hasOwnProperty,O=j.toString,R=C?C.toStringTag:void 0;var N=function(t){var e=T.call(t,R),n=t[R];try{var r=!(t[R]=void 0)}catch(t){}var o=O.call(t);return r&&(e?t[R]=n:delete t[R]),o},z=Object.prototype.toString;var A=function(t){return z.call(t)},G=C?C.toStringTag:void 0;var B=function(t){return null==t?void 0===t?"[object Undefined]":"[object Null]":G&&G in Object(t)?N(t):A(t)},D="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t};var F=function(t){var e=void 0===t?"undefined":D(t);return null!=t&&("object"==e||"function"==e)};var W,X=function(t){if(!F(t))return!1;var e=B(t);return"[object Function]"==e||"[object GeneratorFunction]"==e||"[object AsyncFunction]"==e||"[object Proxy]"==e},q=I["__core-js_shared__"],U=(W=/[^.]+$/.exec(q&&q.keys&&q.keys.IE_PROTO||""))?"Symbol(src)_1."+W:"";var V=function(t){return!!U&&U in t},Y=Function.prototype.toString;var H=function(t){if(null!=t){try{return Y.call(t)}catch(t){}try{return t+""}catch(t){}}return""},$=/^\[object .+?Constructor\]$/,J=Function.prototype,Q=Object.prototype,Z=J.toString,K=Q.hasOwnProperty,tt=RegExp("^"+Z.call(K).replace(/[\\^$.*+?()[\]{}|]/g,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$");var et=function(t){return!(!F(t)||V(t))&&(X(t)?tt:$).test(H(t))};var nt=function(t,e){return null==t?void 0:t[e]};var rt=function(t,e){var n=nt(t,e);return et(n)?n:void 0},ot=rt(I,"Map"),it=rt(Object,"create");var st=function(){this.__data__=it?it(null):{},this.size=0};var at=function(t){var e=this.has(t)&&delete this.__data__[t];return this.size-=e?1:0,e},ut=Object.prototype.hasOwnProperty;var ct=function(t){var e=this.__data__;if(it){var n=e[t];return"__lodash_hash_undefined__"===n?void 0:n}return ut.call(e,t)?e[t]:void 0},ht=Object.prototype.hasOwnProperty;var lt=function(t){var e=this.__data__;return it?void 0!==e[t]:ht.call(e,t)};var yt=function(t,e){var n=this.__data__;return this.size+=this.has(t)?0:1,n[t]=it&&void 0===e?"__lodash_hash_undefined__":e,this};function pt(t){var e=-1,n=null==t?0:t.length;for(this.clear();++e<n;){var r=t[e];this.set(r[0],r[1])}}pt.prototype.clear=st,pt.prototype.delete=at,pt.prototype.get=ct,pt.prototype.has=lt,pt.prototype.set=yt;var ft=pt;var dt=function(){this.size=0,this.__data__={hash:new ft,map:new(ot||_),string:new ft}},vt="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t};var gt=function(t){var e=void 0===t?"undefined":vt(t);return"string"==e||"number"==e||"symbol"==e||"boolean"==e?"__proto__"!==t:null===t};var mt=function(t,e){var n=t.__data__;return gt(e)?n["string"==typeof e?"string":"hash"]:n.map};var xt=function(t){var e=mt(this,t).delete(t);return this.size-=e?1:0,e};var bt=function(t){return mt(this,t).get(t)};var _t=function(t){return mt(this,t).has(t)};var wt=function(t,e){var n=mt(this,t),r=n.size;return n.set(t,e),this.size+=n.size==r?0:1,this};function Pt(t){var e=-1,n=null==t?0:t.length;for(this.clear();++e<n;){var r=t[e];this.set(r[0],r[1])}}Pt.prototype.clear=dt,Pt.prototype.delete=xt,Pt.prototype.get=bt,Pt.prototype.has=_t,Pt.prototype.set=wt;var St=Pt;var Mt=function(t,e){var n=this.__data__;if(n instanceof _){var r=n.__data__;if(!ot||r.length<199)return r.push([t,e]),this.size=++n.size,this;n=this.__data__=new St(r)}return n.set(t,e),this.size=n.size,this};function kt(t){var e=this.__data__=new _(t);this.size=e.size}kt.prototype.clear=w,kt.prototype.delete=P,kt.prototype.get=S,kt.prototype.has=M,kt.prototype.set=Mt;var Et=kt;var Lt=function(t){return this.__data__.has(t)};function It(t){var e=-1,n=null==t?0:t.length;for(this.__data__=new St;++e<n;)this.add(t[e])}It.prototype.add=It.prototype.push=function(t){return this.__data__.set(t,"__lodash_hash_undefined__"),this},It.prototype.has=Lt;var Ct=It;var jt=function(t,e){for(var n=-1,r=null==t?0:t.length;++n<r;)if(e(t[n],n,t))return!0;return!1};var Tt=function(t,e){return t.has(e)};var Ot=function(t,e,n,r,o,i){var s=1&n,a=t.length,u=e.length;if(a!=u&&!(s&&a<u))return!1;var c=i.get(t);if(c&&i.get(e))return c==e;var h=-1,l=!0,y=2&n?new Ct:void 0;for(i.set(t,e),i.set(e,t);++h<a;){var p=t[h],f=e[h];if(r)var d=s?r(f,p,h,e,t,i):r(p,f,h,t,e,i);if(void 0!==d){if(d)continue;l=!1;break}if(y){if(!jt(e,function(t,e){if(!Tt(y,e)&&(p===t||o(p,t,n,r,i)))return y.push(e)})){l=!1;break}}else if(p!==f&&!o(p,f,n,r,i)){l=!1;break}}return i.delete(t),i.delete(e),l},Rt=I.Uint8Array;var Nt=function(t){var n=-1,r=Array(t.size);return t.forEach(function(t,e){r[++n]=[e,t]}),r};var zt=function(t){var e=-1,n=Array(t.size);return t.forEach(function(t){n[++e]=t}),n},At=C?C.prototype:void 0,Gt=At?At.valueOf:void 0;var Bt=function(t,e,n,r,o,i,s){switch(n){case"[object DataView]":if(t.byteLength!=e.byteLength||t.byteOffset!=e.byteOffset)return!1;t=t.buffer,e=e.buffer;case"[object ArrayBuffer]":return!(t.byteLength!=e.byteLength||!i(new Rt(t),new Rt(e)));case"[object Boolean]":case"[object Date]":case"[object Number]":return l(+t,+e);case"[object Error]":return t.name==e.name&&t.message==e.message;case"[object RegExp]":case"[object String]":return t==e+"";case"[object Map]":var a=Nt;case"[object Set]":var u=1&r;if(a||(a=zt),t.size!=e.size&&!u)return!1;var c=s.get(t);if(c)return c==e;r|=2,s.set(t,e);var h=Ot(a(t),a(e),r,o,i,s);return s.delete(t),h;case"[object Symbol]":if(Gt)return Gt.call(t)==Gt.call(e)}return!1};var Dt=function(t,e){for(var n=-1,r=e.length,o=t.length;++n<r;)t[o+n]=e[n];return t},Ft=Array.isArray;var Wt=function(t,e,n){var r=e(t);return Ft(t)?r:Dt(r,n(t))};var Xt=function(t,e){for(var n=-1,r=null==t?0:t.length,o=0,i=[];++n<r;){var s=t[n];e(s,n,t)&&(i[o++]=s)}return i};var qt=function(){return[]},Ut=Object.prototype.propertyIsEnumerable,Vt=Object.getOwnPropertySymbols,Yt=Vt?function(e){return null==e?[]:(e=Object(e),Xt(Vt(e),function(t){return Ut.call(e,t)}))}:qt;var Ht=function(t,e){for(var n=-1,r=Array(t);++n<t;)r[n]=e(n);return r},$t="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t};var Jt=function(t){return null!=t&&"object"==(void 0===t?"undefined":$t(t))};var Qt=function(t){return Jt(t)&&"[object Arguments]"==B(t)},Zt=Object.prototype,Kt=Zt.hasOwnProperty,te=Zt.propertyIsEnumerable,ee=Qt(function(){return arguments}())?Qt:function(t){return Jt(t)&&Kt.call(t,"callee")&&!te.call(t,"callee")};var ne=function(){return!1},re=n(function(t,e){var n=e&&!e.nodeType&&e,r=n&&t&&!t.nodeType&&t,o=r&&r.exports===n?I.Buffer:void 0,i=(o?o.isBuffer:void 0)||ne;t.exports=i}),oe="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},ie=/^(?:0|[1-9]\d*)$/;var se=function(t,e){var n=void 0===t?"undefined":oe(t);return!!(e=null==e?9007199254740991:e)&&("number"==n||"symbol"!=n&&ie.test(t))&&-1<t&&t%1==0&&t<e};var ae=function(t){return"number"==typeof t&&-1<t&&t%1==0&&t<=9007199254740991},ue={};ue["[object Float32Array]"]=ue["[object Float64Array]"]=ue["[object Int8Array]"]=ue["[object Int16Array]"]=ue["[object Int32Array]"]=ue["[object Uint8Array]"]=ue["[object Uint8ClampedArray]"]=ue["[object Uint16Array]"]=ue["[object Uint32Array]"]=!0,ue["[object Arguments]"]=ue["[object Array]"]=ue["[object ArrayBuffer]"]=ue["[object Boolean]"]=ue["[object DataView]"]=ue["[object Date]"]=ue["[object Error]"]=ue["[object Function]"]=ue["[object Map]"]=ue["[object Number]"]=ue["[object Object]"]=ue["[object RegExp]"]=ue["[object Set]"]=ue["[object String]"]=ue["[object WeakMap]"]=!1;var ce=function(t){return Jt(t)&&ae(t.length)&&!!ue[B(t)]};var he=function(e){return function(t){return e(t)}},le=n(function(t,e){var n=e&&!e.nodeType&&e,r=n&&t&&!t.nodeType&&t,o=r&&r.exports===n&&k.process,i=function(){try{var t=r&&r.require&&r.require("util").types;return t||o&&o.binding&&o.binding("util")}catch(t){}}();t.exports=i}),ye=le&&le.isTypedArray,pe=ye?he(ye):ce,fe=Object.prototype.hasOwnProperty;var de=function(t,e){var n=Ft(t),r=!n&&ee(t),o=!n&&!r&&re(t),i=!n&&!r&&!o&&pe(t),s=n||r||o||i,a=s?Ht(t.length,String):[],u=a.length;for(var c in t)!e&&!fe.call(t,c)||s&&("length"==c||o&&("offset"==c||"parent"==c)||i&&("buffer"==c||"byteLength"==c||"byteOffset"==c)||se(c,u))||a.push(c);return a},ve=Object.prototype;var ge=function(t){var e=t&&t.constructor;return t===("function"==typeof e&&e.prototype||ve)};var me=function(e,n){return function(t){return e(n(t))}}(Object.keys,Object),xe=Object.prototype.hasOwnProperty;var be=function(t){if(!ge(t))return me(t);var e=[];for(var n in Object(t))xe.call(t,n)&&"constructor"!=n&&e.push(n);return e};var _e=function(t){return null!=t&&ae(t.length)&&!X(t)};var we=function(t){return _e(t)?de(t):be(t)};var Pe=function(t){return Wt(t,we,Yt)},Se=Object.prototype.hasOwnProperty;var Me=function(t,e,n,r,o,i){var s=1&n,a=Pe(t),u=a.length;if(u!=Pe(e).length&&!s)return!1;for(var c=u;c--;){var h=a[c];if(!(s?h in e:Se.call(e,h)))return!1}var l=i.get(t);if(l&&i.get(e))return l==e;var y=!0;i.set(t,e),i.set(e,t);for(var p=s;++c<u;){var f=t[h=a[c]],d=e[h];if(r)var v=s?r(d,f,h,e,t,i):r(f,d,h,t,e,i);if(!(void 0===v?f===d||o(f,d,n,r,i):v)){y=!1;break}p||(p="constructor"==h)}if(y&&!p){var g=t.constructor,m=e.constructor;g!=m&&"constructor"in t&&"constructor"in e&&!("function"==typeof g&&g instanceof g&&"function"==typeof m&&m instanceof m)&&(y=!1)}return i.delete(t),i.delete(e),y},ke=rt(I,"DataView"),Ee=rt(I,"Promise"),Le=rt(I,"Set"),Ie=rt(I,"WeakMap"),Ce="[object Map]",je="[object Promise]",Te="[object Set]",Oe="[object WeakMap]",Re="[object DataView]",Ne=H(ke),ze=H(ot),Ae=H(Ee),Ge=H(Le),Be=H(Ie),De=B;(ke&&De(new ke(new ArrayBuffer(1)))!=Re||ot&&De(new ot)!=Ce||Ee&&De(Ee.resolve())!=je||Le&&De(new Le)!=Te||Ie&&De(new Ie)!=Oe)&&(De=function(t){var e=B(t),n="[object Object]"==e?t.constructor:void 0,r=n?H(n):"";if(r)switch(r){case Ne:return Re;case ze:return Ce;case Ae:return je;case Ge:return Te;case Be:return Oe}return e});var Fe=De,We="[object Arguments]",Xe="[object Array]",qe="[object Object]",Ue=Object.prototype.hasOwnProperty;var Ve=function(t,e,n,r,o,i){var s=Ft(t),a=Ft(e),u=s?Xe:Fe(t),c=a?Xe:Fe(e),h=(u=u==We?qe:u)==qe,l=(c=c==We?qe:c)==qe,y=u==c;if(y&&re(t)){if(!re(e))return!1;h=!(s=!0)}if(y&&!h)return i||(i=new Et),s||pe(t)?Ot(t,e,n,r,o,i):Bt(t,e,u,n,r,o,i);if(!(1&n)){var p=h&&Ue.call(t,"__wrapped__"),f=l&&Ue.call(e,"__wrapped__");if(p||f){var d=p?t.value():t,v=f?e.value():e;return i||(i=new Et),o(d,v,n,r,i)}}return!!y&&(i||(i=new Et),Me(t,e,n,r,o,i))};var Ye=function t(e,n,r,o,i){return e===n||(null==e||null==n||!Jt(e)&&!Jt(n)?e!=e&&n!=n:Ve(e,n,r,o,t,i))};var He=function(t,e){return Ye(t,e)},$e=C?C.isConcatSpreadable:void 0;var Je=function(t){return Ft(t)||ee(t)||!!($e&&t&&t[$e])};var Qe=function t(e,n,r,o,i){var s=-1,a=e.length;for(r||(r=Je),i||(i=[]);++s<a;){var u=e[s];0<n&&r(u)?1<n?t(u,n-1,r,o,i):Dt(i,u):o||(i[i.length]=u)}return i};var Ze=function(t){return t};var Ke=function(t,e,n){switch(n.length){case 0:return t.call(e);case 1:return t.call(e,n[0]);case 2:return t.call(e,n[0],n[1]);case 3:return t.call(e,n[0],n[1],n[2])}return t.apply(e,n)},tn=Math.max;var en=function(i,s,a){return s=tn(void 0===s?i.length-1:s,0),function(){for(var t=arguments,e=-1,n=tn(t.length-s,0),r=Array(n);++e<n;)r[e]=t[s+e];e=-1;for(var o=Array(s+1);++e<s;)o[e]=t[e];return o[s]=a(r),Ke(i,this,o)}};var nn=function(t){return function(){return t}},rn=function(){try{var t=rt(Object,"defineProperty");return t({},"",{}),t}catch(t){}}(),on=rn?function(t,e){return rn(t,"toString",{configurable:!0,enumerable:!1,value:nn(e),writable:!0})}:Ze,sn=Date.now;var an=function(n){var r=0,o=0;return function(){var t=sn(),e=16-(t-o);if(o=t,0<e){if(800<=++r)return arguments[0]}else r=0;return n.apply(void 0,arguments)}}(on);var un=function(t,e){return an(en(t,e,Ze),t+"")};var cn=function(t,e,n,r){for(var o=t.length,i=n+(r?1:-1);r?i--:++i<o;)if(e(t[i],i,t))return i;return-1};var hn=function(t){return t!=t};var ln=function(t,e,n){for(var r=n-1,o=t.length;++r<o;)if(t[r]===e)return r;return-1};var yn=function(t,e,n){return e==e?ln(t,e,n):cn(t,hn,n)};var pn=function(t,e){return!(null==t||!t.length)&&-1<yn(t,e,0)};var fn=function(t,e,n){for(var r=-1,o=null==t?0:t.length;++r<o;)if(n(e,t[r]))return!0;return!1};var dn=function(){},vn=Le&&1/zt(new Le([,-0]))[1]==1/0?function(t){return new Le(t)}:dn;var gn=function(t,e,n){var r=-1,o=pn,i=t.length,s=!0,a=[],u=a;if(n)s=!1,o=fn;else if(200<=i){var c=e?null:vn(t);if(c)return zt(c);s=!1,o=Tt,u=new Ct}else u=e?[]:a;t:for(;++r<i;){var h=t[r],l=e?e(h):h;if(h=n||0!==h?h:0,s&&l==l){for(var y=u.length;y--;)if(u[y]===l)continue t;e&&u.push(l),a.push(h)}else o(u,l,n)||(u!==a&&u.push(l),a.push(h))}return a};var mn=function(t){return Jt(t)&&_e(t)};var xn=function(t){var e=null==t?0:t.length;return e?t[e-1]:void 0},bn=un(function(t){var e=xn(t);return e="function"==typeof e?e:void 0,gn(Qe(t,1,mn,!0),void 0,e)});var _n=function(t){return null!=t&&t.length?Qe(t,1/0):[]};function wn(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):function(t,e){for(var n=Object.getOwnPropertyNames(e),r=0;r<n.length;r++){var o=n[r],i=Object.getOwnPropertyDescriptor(e,o);i&&i.configurable&&void 0===t[o]&&Object.defineProperty(t,o,i)}}(t,e))}var Pn=function(n){function r(t){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,r);var e=function(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}(this,n.call(this,t));return e._layerName=maptalks.INTERNAL_LAYER_PREFIX+"_CDSP",e._layerTMP=maptalks.INTERNAL_LAYER_PREFIX+"_CDSP_TMP",e._chooseGeos=[],e._colorHit="#ffa400",e._colorChoose="#00bcd4",e}return wn(r,n),r.prototype.combine=function(t,e){if(t instanceof maptalks.Geometry)return this._initialTaskWithGeo(t,"combine"),e instanceof maptalks.Geometry&&(e=[e]),e instanceof Array&&0<e.length?this._compositWithTargets(e):this._initialChooseGeos(t),this},r.prototype.decompose=function(t,e){if(t instanceof maptalks.GeometryCollection)return this._initialTaskWithGeo(t,"decompose"),e instanceof maptalks.Geometry&&(e=[e]),e instanceof Array&&0<e.length?this._decomposeWithTargets(e):this._initialChooseGeos(t),this},r.prototype.peel=function(t,e){if(t instanceof maptalks.Polygon)return this._initialTaskWithGeo(t,"peel"),e instanceof maptalks.Polygon&&(e=[e]),e instanceof Array&&0<e.length&&(this._peelWithTargets(e),this.remove()),this},r.prototype.fill=function(t,e,n){var r=this;if(t instanceof maptalks.MultiPolygon){if(this._initialTaskWithGeo(t,"fill"),n)this._fillAll(),this.remove();else if(e instanceof maptalks.Polygon&&(e=[e]),e instanceof Array&&0<e.length)this._fillWithTargets(e),this.remove();else{var o=this.geometry.getCoordinates()[0],i=this.geometry.getSymbol();i.polygonOpacity=0,o.forEach(function(t,e){0<e&&new maptalks.Polygon([o[e]],{symbol:i}).addTo(r._tmpLayer)})}return this}},r.prototype.split=function(t,e){if(t instanceof maptalks.Polygon||t instanceof maptalks.LineString)return this._initialTaskWithGeo(t,"split"),e instanceof maptalks.LineString&&(e=[e]),e instanceof Array&&0<e.length&&(this._splitWithTargets(e),this.remove()),this},r.prototype.submit=function(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:function(){return!1};switch(this._task){case"combine":this._submitCombine();break;case"decompose":this._submitDecompose();break;case"peel":this._submitPeel();break;case"fill":this._submitFill();break;case"split":this._submitSplit()}t(this._result,this._deals),this.remove()},r.prototype.cancel=function(){this.remove()},r.prototype.remove=function(){this._map;this._tmpLayer&&this._tmpLayer.remove(),this._chooseLayer&&this._chooseLayer.remove(),this._chooseGeos=[],this._offMapEvents(),delete this._result,delete this._deals,delete this._task,delete this._tmpLayer,delete this._chooseLayer,delete this._mousemove,delete this._click,delete this._dblclick},r.prototype._initialTaskWithGeo=function(t,e){this._insureSafeTask(),this._task=e,this._savePrivateGeometry(t)},r.prototype._initialChooseGeos=function(t){var e=this;switch(this._task){case"combine":this._chooseGeos=[t];break;case"decompose":t._geometries.forEach(function(t){return t.copy().addTo(e._tmpLayer)}),this._chooseGeos=this._tmpLayer.getGeometries()}this._updateChooseGeos()},r.prototype._insureSafeTask=function(){map._map_tool&&drawTool instanceof maptalks.DrawTool&&drawTool.disable(),this.geometry&&this.remove()},r.prototype._savePrivateGeometry=function(t){this.geometry=t,this.layer=t._layer,t.type.startsWith("Multi")&&(this.layer=t._geometries[0]._layer),this._addTo(this.layer.map)},r.prototype._addTo=function(t){return this._chooseLayer&&this.remove(),this._map=t,this._tmpLayer=new maptalks.VectorLayer(this._layerTMP).addTo(t).bringToFront(),this._chooseLayer=new maptalks.VectorLayer(this._layerName).addTo(t).bringToFront(),this._registerMapEvents(),this},r.prototype._registerMapEvents=function(){var e=this;if(!this._mousemove){var t=this._map;this._mousemove=function(t){return e._mousemoveEvents(t)},this._click=function(t){return e._clickEvents(t)},t.on("mousemove",this._mousemove,this),t.on("click",this._click,this)}},r.prototype._offMapEvents=function(){if(this._mousemove){var t=this._map;t.off("mousemove",this._mousemove,this),t.off("click",this._click,this)}},r.prototype._mousemoveEvents=function(t){var n=this,r=[],e=!1;switch(this._task){case"combine":r=this.layer.identify(t.coordinate);break;case"decompose":r=this._tmpLayer.identify(t.coordinate);break;case"peel":var o=this._getSafeCoords();this.layer.identify(t.coordinate).forEach(function(t){var e=n._getSafeCoords(t);He(e,o)||r.push(t)});break;case"fill":r=this._tmpLayer.identify(t.coordinate);break;case"split":var i=this._getSafeCoords();this.layer.identify(t.coordinate).forEach(function(t){var e=n._getSafeCoords(t);!He(e,i)&&t instanceof maptalks.LineString&&r.push(t)}),e=!0}this._updateHitGeo(r,e)},r.prototype._getSafeCoords=function(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:this.geometry,e=t.getCoordinates();if(t.options.numberOfShellPoints){var n=t.options,r=n.numberOfShellPoints;n.numberOfShellPoints=300,t.setOptions(n),e=[t.getShell()],n.numberOfShellPoints=r||60,t.setOptions(n)}return e},r.prototype._updateHitGeo=function(t,e){if(this._needRefreshSymbol){var n=this._chooseLayer.getGeometryById("_hit");n&&(n.remove(),delete this.hitGeo),this._needRefreshSymbol=!1}if(t&&0<t.length)if(this._needRefreshSymbol=!0,this.hitGeo=t[0],this._checkIsSameType(this.hitGeo)||e){var r=this._getSymbolOrDefault(this.hitGeo,"Hit");this._copyGeoUpdateSymbol(this.hitGeo,r).setId("_hit")}else delete this.hitGeo},r.prototype._checkIsSameType=function(t){var e=t.type,n=this.geometry.type;return e.includes(n)||n.includes(e)},r.prototype._getSymbolOrDefault=function(t,e){var n=t.getSymbol(),r=this["_color"+e];if(n){for(var o in n)(o.endsWith("Fill")||o.endsWith("Color"))&&(n[o]=r);n.lineWidth=4}else n=t.type.endsWith("Point")?{markerFill:r,markerType:"path",markerPath:[{path:"M8 23l0 0 0 0 0 0 0 0 0 0c-4,-5 -8,-10 -8,-14 0,-5 4,-9 8,-9l0 0 0 0c4,0 8,4 8,9 0,4 -4,9 -8,14z M3,9 a5,5 0,1,0,0,-0.9Z",fill:"#DE3333"}],markerPathWidth:16,markerPathHeight:23,markerWidth:24,markerHeight:34}:{lineColor:r,lineWidth:4};return n},r.prototype._copyGeoUpdateSymbol=function(t,e){return t.copy().updateSymbol(e).addTo(this._chooseLayer)},r.prototype._clickEvents=function(t){switch(this._task){case"combine":this._clickCombine();break;case"decompose":this._clickDecompose(t);break;default:if(this.hitGeo){var e=this._getSafeCoords(this.hitGeo);this._setChooseGeosExceptHit(e),this._updateChooseGeos()}}},r.prototype._clickCombine=function(){if(this.hitGeo){var t=this._getSafeCoords(this.hitGeo),e=this._getSafeCoords();if(He(t,e))return null;this._setChooseGeosExceptHit(t),this._updateChooseGeos()}},r.prototype._setChooseGeosExceptHit=function(n,t){var r=this,o=[];this._chooseGeos.forEach(function(t){var e=r._getSafeCoords(t);He(n,e)||o.push(t)}),t||o.length!==this._chooseGeos.length?this._chooseGeos=o:this._chooseGeos.push(this.hitGeo)},r.prototype._updateChooseGeos=function(){var n=this;this._chooseLayer.clear(),this._chooseGeos.forEach(function(t){var e=n._getSymbolOrDefault(t,"Choose");n._copyGeoUpdateSymbol(t,e)})},r.prototype._clickDecompose=function(t){var e=[];if(this._chooseLayer.identify(t.coordinate).forEach(function(t){"_hit"!==t.getId()&&e.push(t)}),0<e.length){var n=e[0],r=this._getSafeCoords(n);this._setChooseGeosExceptHit(r,!0),n.remove()}else this.hitGeo&&this._chooseGeos.push(this.hitGeo);this._updateChooseGeos()},r.prototype._submitCombine=function(){this._compositWithTargets()},r.prototype._compositWithTargets=function(){var n=this,t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:this._chooseGeos;this._deals=[],t.forEach(function(t){return n._deals.push(t.copy())});var r=this._getGeoStringifyCoords(t),o=[];this.layer.getGeometries().forEach(function(t){var e=n._getGeoStringifyCoords(t);r.includes(e)&&(t.type.startsWith("Multi")?t._geometries.forEach(function(t){return o.push(t.copy())}):o.push(t.copy()),t.remove())}),this._compositResultGeo(o)},r.prototype._getGeoStringifyCoords=function(t){var e=this;if(t instanceof Array){var n=[];return t.forEach(function(t){return n.push(JSON.stringify(e._getSafeCoords(t)))}),n}return JSON.stringify(this._getSafeCoords(t))},r.prototype._compositResultGeo=function(t){var e=t.length;if(!e||0===e)return null;var n=void 0;switch(t[0].type){case"Point":n=new maptalks.MultiPoint(t);break;case"LineString":n=new maptalks.MultiLineString(t);break;default:n=new maptalks.MultiPolygon(t)}n.setSymbol(this.geometry.getSymbol()),n.setProperties(this.geometry.getProperties()),n.addTo(this.layer),this._result=n},r.prototype._submitDecompose=function(){this._decomposeWithTargets()},r.prototype._decomposeWithTargets=function(){var n=this,t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:this._chooseLayer.getGeometries(),r=[];t.forEach(function(t){"_hit"!==t.getId()&&r.push(n._getGeoStringifyCoords(t))});var o=[];this._deals=[],this._tmpLayer.getGeometries().forEach(function(t){var e=n._getGeoStringifyCoords(t);r.includes(e)?o.push(t.copy()):(t=t.copy().addTo(n.layer),n._deals.push(t))}),this.geometry.remove(),this._compositResultGeo(o)},r.prototype._peelWithTargets=function(){var e=this,t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:this._chooseGeos,n=this.geometry,r=[this._getSafeCoords(n)[0]];this._deals=[],t.forEach(function(t){t instanceof maptalks.MultiPolygon?t._geometries.forEach(function(t){return r.push(e._getSafeCoords(t)[0])}):r.push(e._getSafeCoords(t)[0]),e._deals.push(t.copy()),t.remove()}),this._result=new maptalks.MultiPolygon([r],{symbol:n.getSymbol(),properties:n.getProperties()}).addTo(n._layer),n.remove()},r.prototype._submitPeel=function(){this._peelWithTargets()},r.prototype._submitFill=function(){this._fillWithTargets()},r.prototype._submitSplit=function(){this._splitWithTargets()},r.prototype._fillAll=function(){var t=this.geometry.getCoordinates(),e=this.geometry.getSymbol(),n=this.geometry.getProperties();new maptalks.Polygon([t[0][0]],{symbol:e,properties:n}).addTo(this.layer),this.geometry.remove()},r.prototype._fillWithTargets=function(){var n=this,t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:this._chooseGeos,r=this.geometry.getSymbol(),e=this.geometry.getProperties(),o=[];this._deals=[],t.forEach(function(t){var e=JSON.stringify(t.getCoordinates()[0]);o.push(e),n._deals.push(t.setSymbol(r).copy())});var i=[];this.geometry.getCoordinates()[0].forEach(function(t){o.includes(JSON.stringify(t))||i.push(t)}),this._result=new maptalks.MultiPolygon([i],{symbol:r,properties:e}).addTo(this.layer),this.geometry.remove()},r.prototype._splitWithTargets=function(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:this._chooseGeos;this._deals=this.geometry.copy(),this.geometry instanceof maptalks.Polygon&&this._splitPolygonWithTargets(t),this.geometry instanceof maptalks.LineString&&this._splitLineWithTargets(t)},r.prototype._splitPolygonWithTargets=function(t){var r=this,o=void 0;(t=this._getPolygonAvailTargets(t)).forEach(function(e){if(o){var n=[];o.forEach(function(t){r.geometry=t,n.push.apply(n,r._splitPolygonTargetBase(e))}),o=n}else o=r._splitPolygonTargetBase(e);e.remove()}),this._result=o},r.prototype._getPolygonAvailTargets=function(t){var e=this,n=[];return t.forEach(function(t){n.push.apply(n,e._getPolygonAvailTarget(t)),t.remove()}),n},r.prototype._getPolygonAvailTarget=function(t){for(var e=[],n=[],r=!1,o=this._getSafeCoords(t),i=0;i<o.length;i++)if(r){e=bn(e,[o[i]],He);var s=this.geometry.containsPoint(o[i-1]),a=!this.geometry.containsPoint(o[i]);s&&a&&(r=!1,e=bn(e,[o[i]],He),n.push(e),e=[],i--)}else if(o[i+1]){var u=new maptalks.LineString([o[i],o[i+1]]);if(0<this._getPolygonPolylineIntersectPoints(u).length){var c=!this.geometry.containsPoint(o[i]),h=this.geometry.containsPoint(o[i+1]);c&&h?(r=!0,e=bn(e,[o[i]],He)):n.push([o[i],o[i+1]])}}var l=[];return n.forEach(function(t){return l.push(new maptalks.LineString(t))}),l},r.prototype._getPolygonPolylineIntersectPoints=function(t){var e=this._getPoint2dFromCoords(this.geometry),n=this._getPoint2dFromCoords(t);return g.intersectPolygonPolyline(e,n).points},r.prototype._splitPolygonTargetBase=function(t){var e=this._getPolygonPolylineIntersectPoints(t),n=void 0;return 2!==this._getSafeCoords(t).length&&2!==e.length?[this.geometry]:(2===this._getSafeCoords(t).length?n=this._splitWithTargetCommon(t):2===e.length&&(n=this._splitWithTargetMoreTwo(t)),this.geometry.remove(),n)},r.prototype._splitWithTargetCommon=function(t){for(var e=this,n=this._getSafeCoords()[0],r=this._getPoint2dFromCoords(t),o=!0,i=[],s=[],a=[],u=0;u<n.length-1;u++){var c=new maptalks.LineString([n[u],n[u+1]]),h=this._getPoint2dFromCoords(c),l=g.intersectPolylinePolyline(r,h).points,y=this._getCoordsFromPoints(l)[0];He(n[u],y)||0<l.length?(o?(i.push(n[u],y),s.push(y)):(i.push(y),s.push(n[u],y),a.push(s),s=[]),o=!o):o?i.push(n[u]):s.push(n[u])}var p=[],f=this.geometry.getSymbol(),d=this.geometry.getProperties(),v=new maptalks.Polygon(i,{symbol:f,properties:d}).addTo(this.layer);return p.push(v),a.forEach(function(t){v=new maptalks.Polygon(t,{symbol:f,properties:d}).addTo(e.layer),p.push(v)}),p},r.prototype._getPoint2dFromCoords=function(t){var e=this._map,n=e.getZoom(),r=this._getSafeCoords(t),o=[];return _n(r).forEach(function(t){return o.push(e.coordinateToPoint(t,n))}),o},r.prototype._getCoordsFromPoints=function(t){t instanceof Array||(t=[t]);var e=this._map,n=e.getZoom(),r=[];return t.forEach(function(t){return r.push(e.pointToCoordinate(t,n))}),r},r.prototype._splitWithTargetMoreTwo=function(t){for(var e=this._getSafeCoords()[0],n=this._getPoint2dFromCoords(t),r=!0,o=[],i=[],s=[],a=0;a<e.length-1;a++){var u=new maptalks.LineString([e[a],e[a+1]]),c=this._getPoint2dFromCoords(u),h=g.intersectPolylinePolyline(n,c).points,l=this._getCoordsFromPoints(h),y=l[0];He(e[a],y)||0<h.length?(r?o.push(e[a],y):o.push(y),0===s.length&&0<(s=this._getTargetGap(t,h[0])).length&&(o.push.apply(o,s),i.push.apply(i,s.reverse())),r?i.push(y):i.push(e[a],y),1<l.length?(o.push(l[1]),i.push(l[1])):r=!r):r?o.push(e[a]):i.push(e[a])}var p=[],f=this.geometry.getSymbol(),d=this.geometry.getProperties(),v=new maptalks.Polygon(o,{symbol:f,properties:d}).addTo(this.layer);return p.push(v),v=new maptalks.Polygon(i,{symbol:f,properties:d}).addTo(this.layer),p.push(v),p},r.prototype._getTargetGap=function(t,e){var n=this._getSafeCoords(t),r=(this._getPoint2dFromCoords(this.geometry),!1),o=[],i=void 0;this._tmpLayer.hide();for(var s=0;s<n.length-1;s++){r&&o.push(s);var a=new maptalks.LineString([n[s],n[s+1]]),u=this._getPolygonPolylineIntersectPoints(a);0<u.length&&(He(u[0],e)&&(i=s+1),r=!r)}this._tmpLayer.clear().show(),o[0]!==i&&o.reverse();var c=[];return o.forEach(function(t){return c.push(n[t])}),c},r.prototype._splitLineWithTargets=function(t){var r=this;t=this._getLineAvailTargets(t);var o=void 0;t.forEach(function(e){if(o){var n=[];o.forEach(function(t){r.geometry=t,n.push.apply(n,r._splitLineTargetBase(e))}),o=n}else o=r._splitLineTargetBase(e);e.remove()}),this._result=o},r.prototype._splitLineTargetBase=function(t){for(var e=this,n=this._getPoint2dFromCoords(t),r=this._getSafeCoords(),o=[r[0]],i=[],s=0;s<r.length;s++)if(r[s+1]){var a=new maptalks.LineString([r[s],r[s+1]]),u=this._getPoint2dFromCoords(a),c=g.intersectPolylinePolyline(n,u).points;if(0<c.length){var h=this._getCoordsFromPoints(c)[0];o.push(h),i.push(o),o=[h,r[s+1]]}else o.push(r[s+1])}else 0<o.length&&(o.push(r[s]),i.push(o));var l=[];return i.forEach(function(t){return l.push(new maptalks.LineString(t).addTo(e.layer))}),this.geometry.remove(),l},r.prototype._getLineAvailTargets=function(t){var e=this,n=[];return t.forEach(function(t){n.push.apply(n,e._getLineAvailTarget(t)),t.remove()}),n},r.prototype._getLineAvailTarget=function(t){for(var e=[],n=this._getSafeCoords(t),r=0;r<n.length-1;r++){var o=new maptalks.LineString([n[r],n[r+1]]);0<this._getPolygonPolylineIntersectPoints(o).length&&e.push(o)}return e},r}(maptalks.Class);MultiSuite.mergeOptions({}),t.GeoSplit=Pn,Object.defineProperty(t,"__esModule",{value:!0}),"undefined"!=typeof console&&console.log("maptalks.geosplit v0.1.0-alpha.1")});